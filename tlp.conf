# ----------------------------------------------------------------------------
# ThinkPad T440s — Balanced Performance TLP Configuration
# Intel i5-4300U | 12 GB RAM | Integrated Intel HD 4400
# Target: Smooth multitasking + good battery efficiency
# ----------------------------------------------------------------------------

TLP_ENABLE=1
TLP_AUTO_SWITCH=2        # Smart switching between AC and battery
TLP_DEFAULT_MODE=AC
TLP_PERSISTENT_DEFAULT=0

# ----------------------------------------------------------------------------
# CPU PERFORMANCE AND POWER
# ----------------------------------------------------------------------------

# Use intel_pstate driver in active mode
CPU_DRIVER_OPMODE_ON_AC=active
CPU_DRIVER_OPMODE_ON_BAT=active

# Valid governors for Intel P-State active mode: performance / powersave
CPU_SCALING_GOVERNOR_ON_AC=performance
CPU_SCALING_GOVERNOR_ON_BAT=powersave

# Fine-tune energy/performance balance
CPU_ENERGY_PERF_POLICY_ON_AC=performance
CPU_ENERGY_PERF_POLICY_ON_BAT=balance_performance

# Turbo Boost always allowed for responsiveness
CPU_BOOST_ON_AC=1
CPU_BOOST_ON_BAT=1

# Set CPU performance percentage limits
CPU_MIN_PERF_ON_AC=0
CPU_MAX_PERF_ON_AC=100
CPU_MIN_PERF_ON_BAT=0
CPU_MAX_PERF_ON_BAT=85

# Platform performance profile (if firmware supports it)
PLATFORM_PROFILE_ON_AC=performance
PLATFORM_PROFILE_ON_BAT=balanced

# ----------------------------------------------------------------------------
# DISK / SSD MANAGEMENT
# ----------------------------------------------------------------------------

DISK_DEVICES="nvme0n1 sda"
DISK_APM_LEVEL_ON_AC="254 254"
DISK_APM_LEVEL_ON_BAT="128 128"

SATA_LINKPWR_ON_AC=max_performance
SATA_LINKPWR_ON_BAT=med_power_with_dipm
AHCI_RUNTIME_PM_ON_AC=on
AHCI_RUNTIME_PM_ON_BAT=auto
AHCI_RUNTIME_PM_TIMEOUT=15

# ----------------------------------------------------------------------------
# INTEL GPU
# ----------------------------------------------------------------------------

INTEL_GPU_MIN_FREQ_ON_AC=350
INTEL_GPU_MAX_FREQ_ON_AC=1100
INTEL_GPU_BOOST_FREQ_ON_AC=1100

INTEL_GPU_MIN_FREQ_ON_BAT=300
INTEL_GPU_MAX_FREQ_ON_BAT=900
INTEL_GPU_BOOST_FREQ_ON_BAT=900

# ----------------------------------------------------------------------------
# AUDIO AND NETWORK
# ----------------------------------------------------------------------------

SOUND_POWER_SAVE_ON_AC=1
SOUND_POWER_SAVE_ON_BAT=1
SOUND_POWER_SAVE_CONTROLLER=Y

WIFI_PWR_ON_AC=off
WIFI_PWR_ON_BAT=on
WOL_DISABLE=Y

# ----------------------------------------------------------------------------
# USB / PCI RUNTIME POWER
# ----------------------------------------------------------------------------

USB_AUTOSUSPEND=0
PCIE_ASPM_ON_AC=default
PCIE_ASPM_ON_BAT=powersave
RUNTIME_PM_ON_AC=on
RUNTIME_PM_ON_BAT=auto
RUNTIME_PM_DRIVER_DENYLIST="mei_me"

# ----------------------------------------------------------------------------
# BATTERY THRESHOLDS (ThinkPad specific)
# ----------------------------------------------------------------------------
# Keeps charge between 40–80 % to preserve battery health
START_CHARGE_THRESH_BAT0=40
STOP_CHARGE_THRESH_BAT0=80
RESTORE_THRESHOLDS_ON_BAT=1

# ----------------------------------------------------------------------------
# MISCELLANEOUS
# ----------------------------------------------------------------------------

RESTORE_DEVICE_STATE_ON_STARTUP=1
NMI_WATCHDOG=0
